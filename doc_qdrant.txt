Configuração da Nuvem Privada Qdrant
Requisitos
Cluster Kubernetes: Para instalar o Qdrant Private Cloud, você precisa de um cluster Kubernetes compatível com os padrões . Você pode executar esse cluster em qualquer ambiente de nuvem, local ou de borda, com distribuições que variam do AWS EKS ao VMware vSphere. Consulte Plataformas de Implantação para obter mais informações.
Armazenamento: Para armazenamento, você precisa configurar o cluster Kubernetes com um driver CSI (Container Storage Interface) que forneça armazenamento em blocos. Para escalonamento vertical, o driver CSI precisa suportar expansão de volume. Para backups e restaurações, o driver precisa suportar snapshots e restaurações CSI.
Sistemas de armazenamento em rede, como NFS, ou sistemas de armazenamento de objetos, como S3, não são suportados.
Permissões: Para instalar o operador Qdrant Kubernetes, você precisa ter cluster-adminacesso ao seu cluster Kubernetes.
Locais: Por padrão, os gráficos Helm e as imagens de contêiner do Qdrant Operator são servidos a partir de registry.cloud.qdrant.io.
Observação: você também pode espelhar essas imagens e gráficos em seu próprio registro e extraí-los de lá.

ferramentas de linha de comando
Durante o processo de integração, você precisará implantar o operador Kubernetes da Qdrant usando o Helm. Certifique-se de ter as seguintes ferramentas instaladas:

kubectl
leme
Você precisará ter acesso ao cluster Kubernetes kubectle helmconfigurá-lo para se conectar a ele. Consulte a documentação da sua distribuição Kubernetes para obter mais informações.

Artefatos necessários
Imagens de contêiner:

registry.cloud.qdrant.io/qdrant/qdrant
registry.cloud.qdrant.io/qdrant/operator
registry.cloud.qdrant.io/qdrant/cluster-manager
registry.cloud.qdrant.io/qdrant/qdrant-cluster-exporter
Gráficos Helm da Open Containers Initiative (OCI):

registry.cloud.qdrant.io/qdrant-charts/qdrant-private-cloud

registry.cloud.qdrant.io/library/qdrant-kubernetes-api

As versões específicas para cada versão de nuvem privada estão documentadas no Registro de Alterações da Nuvem Privada .

Instalação
Após a integração ao Qdrant Private Cloud, você receberá as credenciais para acessar o Registro do Qdrant Cloud. Você pode usar essas credenciais para instalar a solução Qdrant Private Cloud utilizando os seguintes comandos:

Crie o namespace para sua implantação de Nuvem Privada. Você pode usar qualquer nome para o namespace, mas precisará atualizar as etapas posteriores para refletir isso. Exemplo:
kubectl create namespace qdrant-private-cloud

Crie um segredo do Kubernetes com suas credenciais do Qdrant Cloud Registry para permitir que seu cluster Kubernetes baixe as imagens de contêiner necessárias:
kubectl create secret docker-registry qdrant-registry-creds --docker-server=registry.cloud.qdrant.io --docker-username='your-username' --docker-password='your-password' --namespace qdrant-private-cloud

Faça login no Qdrant Cloud Registry usando o Helm:
helm registry login 'registry.cloud.qdrant.io' --username 'your-username' --password 'your-password'

Instale as definições de recursos personalizados (CRDs) do operador Kubernetes da Qdrant:
helm upgrade --install qdrant-private-cloud-crds oci://registry.cloud.qdrant.io/qdrant-charts/qdrant-kubernetes-api --namespace qdrant-private-cloud --version v1.22.1 --wait

Instale o Qdrant Private Cloud:
helm upgrade --install qdrant-private-cloud oci://registry.cloud.qdrant.io/qdrant-charts/qdrant-private-cloud --namespace qdrant-private-cloud --version 1.9.3

Certifique-se de que a qdrant-kubernetes-apiversão seja compatível com a qdrant-private-cloudversão que você está instalando.

Para obter uma lista das versões disponíveis, consulte o Changelog da Nuvem Privada .

As versões padrão atuais são:

qdrant-kubernetes-api v1.22.1
qdrant-nuvem-privada 1.9.3
Para obter mais informações, consulte também a Documentação de Instalação do Helm .

Configurando uma Nuvem Privada
O gráfico Helm da Nuvem Privada Qdrant vem com um conjunto de valores padrão adequados para a maioria das implantações. No entanto, você pode personalizar ainda mais a configuração para atender às suas necessidades específicas. Consulte a página de Configuração da Nuvem Privada para obter todas as opções de configuração disponíveis.

Você deve garantir que os valores padrão StorageClassese correspondentes VolumeSnapshotClassestejam configurados adequadamente para o seu ambiente.

Ao criar seu próprio values.yamlarquivo, como boa prática, inclua apenas os valores que você realmente está alterando, por exemplo, neste values.yamlarquivo:

operator:
  settings:
    features:
      clusterManagement:
        storageClass:
          database: your-storage-class-name
          snapshot: your-storage-class-name
      backupManagement:
        snapshots:
          volumeSnapshotClass: your-volume-snapshot-class-name

Você pode configurar o Qdrant Private Cloud desta forma:

helm upgrade --install qdrant-private-cloud oci://registry.cloud.qdrant.io/qdrant-charts/qdrant-private-cloud --namespace qdrant-private-cloud --version 1.9.3 -f values.yaml

Atualizações
Para atualizar o Qdrant Private Cloud para uma nova versão, primeiro atualize as Definições de Recursos Personalizados (CRDs) do operador Kubernetes do Qdrant:

helm upgrade --install qdrant-private-cloud-crds oci://registry.cloud.qdrant.io/qdrant-charts/qdrant-kubernetes-api --namespace qdrant-private-cloud --version v1.22.1 --wait

Em seguida, atualize o gráfico Helm do Qdrant Private Cloud usando os mesmos valores de configuração, por exemplo:

helm upgrade --install qdrant-private-cloud oci://registry.cloud.qdrant.io/qdrant-charts/qdrant-private-cloud --namespace qdrant-private-cloud --version 1.9.3 -f values.yaml

Observe que os valores das tags de imagem são derivados automaticamente das versões do aplicativo do gráfico e não devem ser substituídos no arquivo values.yaml.

Para obter mais informações, consulte também a Documentação de Atualização do Helm .

Espelhamento de imagens e gráficos
Para espelhar todas as imagens de contêiner e gráficos Helm necessários em seu próprio registro, você pode usar um recurso de replicação fornecido pelo seu registro ou sincronizar manualmente as imagens com o Skopeo :

Primeiro, faça login no registro de origem:

skopeo login registry.cloud.qdrant.io

Em seguida, faça login no seu próprio registro:

skopeo login your-registry.example.com

Para sincronizar todas as imagens de contêiner:

skopeo sync --all --src docker --dest docker registry.cloud.qdrant.io/qdrant/qdrant your-registry.example.com/qdrant/qdrant
skopeo sync --all --src docker --dest docker registry.cloud.qdrant.io/qdrant/cluster-manager your-registry.example.com/qdrant/cluster-manager
skopeo sync --all --src docker --dest docker registry.cloud.qdrant.io/qdrant/operator your-registry.example.com/qdrant/operator

Para sincronizar todos os mapas do leme:

skopeo sync --all --src docker --dest docker registry.cloud.qdrant.io/qdrant-charts/qdrant-private-cloud your-registry.example.com/qdrant-charts/qdrant-private-cloud
skopeo sync --all --src docker --dest docker registry.cloud.qdrant.io/qdrant-charts/qdrant-kubernetes-api your-registry.example.com/qdrant-charts/qdrant-kubernetes-api

Durante a instalação ou atualização, você precisará adaptar as informações do repositório de imagens e do imagePullSecret nos valores do gráfico Helm, por exemplo:

operator:
  image:
    repository: your-registry.example.com/qdrant/operator
  imagePullSecrets:
    - name: your-registry-creds
  settings:
    features:
      clusterManagement:
        qdrant:
          image:
            repository: your-registry.example.com/qdrant/qdrant
            pullSecretName: your-registry-creds
            
qdrant-cluster-manager:
  image:
    repository: your-registry.example.com/qdrant/cluster-manager
  imagePullSecrets:
    - name: your-registry-creds
      
qdrant-cluster-exporter:
  image:
    repository: your-registry.example.com/qdrant/qdrant-cluster-exporter
  imagePullSecrets:
    - name: your-registry-creds

Consulte a seção Configuração de Nuvem Privada para obter detalhes.

Âmbito de atuação do operador
Por padrão, o operador Qdrant gerenciará apenas clusters Qdrant no mesmo namespace do Kubernetes em que já está implantado. As associações de função (RoleBindings) também são limitadas a esse namespace específico. Essa configuração padrão foi escolhida para limitar o operador ao mínimo de permissões necessárias dentro de um cluster Kubernetes.

Se você deseja gerenciar clusters Qdrant em vários namespaces com o mesmo operador, pode configurar uma lista de namespaces que o operador deve monitorar:

operator:
  watch:
    # If true, watches only the namespace where the Qdrant operator is deployed, otherwise watches the namespaces in watch.namespaces
    onlyReleaseNamespace: false
    # an empty list watches all namespaces.
    namespaces:
      - qdrant-private-cloud
      - some-other-namespase
  limitRBAC: true

Ou você pode configurar o operador para monitorar todos os namespaces:

operator:
  watch:
    # If true, watches only the namespace where the Qdrant operator is deployed, otherwise watches the namespaces in watch.namespaces
    onlyReleaseNamespace: false
    # an empty list watches all namespaces.
    namespaces: []
  limitRBAC: false

Desinstalação
Para desinstalar a solução Qdrant Private Cloud, você pode usar o seguinte comando:

helm uninstall qdrant-private-cloud --namespace qdrant-private-cloud
helm uninstall qdrant-private-cloud-crds --namespace qdrant-private-cloud
kubectl delete namespace qdrant-private-cloud

Observe que desinstalar o qdrant-private-cloud-crdsgráfico Helm removerá todas as Definições de Recursos Personalizados (CRDs) e também todos os clusters Qdrant que eram gerenciados pelo operador.